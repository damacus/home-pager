app-template:
  defaultPodOptions:
    automountServiceAccountToken: true
    securityContext:
      runAsUser: 65534
      runAsGroup: 65534
      runAsNonRoot: true
      seccompProfile:
        type: RuntimeDefault

  controllers:
    main:
      strategy: RollingUpdate
      replicas: 1
      serviceAccount:
        identifier: main

      containers:
        main:
          image:
            repository: ghcr.io/damacus/home-pager
            tag: "0.1.0"
            pullPolicy: IfNotPresent

          env:
            PORT: "8080"
            KUBERNETES_TIMEOUT: "10s"

          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL

          resources:
            requests:
              cpu: 10m
              memory: 16Mi
            limits:
              memory: 32Mi

          probes:
            liveness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /healthz
                  port: 8080
                initialDelaySeconds: 5
                periodSeconds: 10
            readiness:
              enabled: true
              custom: true
              spec:
                httpGet:
                  path: /readyz
                  port: 8080
                initialDelaySeconds: 5
                periodSeconds: 10

  service:
    main:
      controller: main
      ports:
        http:
          port: 8080

  ingress:
    main:
      enabled: false
      className: ""
      hosts:
        - host: home-pager.local
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: http

  serviceAccount:
    main: {}

  rbac:
    roles:
      ingress-reader:
        type: ClusterRole
        suffix: "{{ .Release.Namespace }}"
        rules:
          - apiGroups: ["networking.k8s.io"]
            resources: ["ingresses"]
            verbs: ["get", "list", "watch"]
    bindings:
      ingress-reader:
        type: ClusterRoleBinding
        suffix: "{{ .Release.Namespace }}"
        roleRef:
          identifier: ingress-reader
        subjects:
          - identifier: main
